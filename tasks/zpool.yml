---
- name: Ensure ZFS is started
  service: name=zfs
           enabled=yes
           state=started

- name: Check if ZFS pool exists
  command: zpool status {{ host_ioc_zpool_name }}
  register: zpool_status
  ignore_errors: yes
  changed_when: false

- name: Create ZFS pool
  command: zpool create {{ host_ioc_zpool_name }} {{ host_ioc_zpool_devices }}
  when: "'no such pool' in zpool_status.stderr"

